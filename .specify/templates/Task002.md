## üé´ Speckit Task: FR-002 Create Special Event

This speckit task details the requirements for creating a new special event via the API, covering the technical specification, data models, and acceptance criteria.

***

### üìù Overview

| Attribute | Value |
| :--- | :--- |
| **Feature ID** | FR-002 |
| **Feature Name** | Create Special Event |
| **Type** | API Endpoint (POST) |
| **Priority** | High |
| **Tags** | `Events` |
| **Related Path** | `/SpecialEvent` |

***

### üéØ Goal (User Story)

As a **Museum Administrator**,
I want to **create and register a new special event** in the system,
So that **visitors can view and plan for it**.

***

### üõ†Ô∏è Technical Specification

#### **Endpoint Definition**

* **Method:** `POST`
* **Path:** `/SpecialEvent`
* **`operationId`:** `createSpecialEvent`
* **Content Type:** `application/json` (in request body)

#### **Request Body Model: `SpecialEvent` (Input)**

| Field | Type | Required | Description | Example |
| :--- | :--- | :--- | :--- | :--- |
| `EventName` | **string** | **Yes** | The descriptive name of the event. | `"Ancient Egypt Exhibit Opening"` |
| `EventLocation` | **string** | **Yes** | The physical location within the museum. | `"West Wing Gallery"` |
| `EventDescription` | **string** | **Yes** | A detailed description of the event. | `"A members-only sneak preview..."` |
| `EventDates` | **array of date** (ISO 8601) | **Yes** | A list of dates when the event takes place. | `["2025-12-05", "2025-12-06"]` |
| `EventPrice` | **number** (decimal) | **Yes** | The cost of the event ticket (e.g., USD). | `25.50` |

#### **Response Body Model: `SpecialEvent` (Output)**

The successful response should return the created object, ideally including a unique identifier generated by the system.

| Field | Type | Description | Example |
| :--- | :--- | :--- | :--- |
| `EventID` | **string/integer** | The unique system ID for the created event. | `12345` |
| *[All Input Fields]* | *[Same as above]* | *...* | *...* |

***

#### **Security Requirements (AuthN & AuthZ)**

| Requirement | Detail | Implication |
| :--- | :--- | :--- |
| **Authentication (AuthN)** | **Required** | Request must contain a **valid JWT** in the `Authorization: Bearer` header. |
| **Authorization (AuthZ)** | **Role-Based Access** | The authenticated user must have the **`administrator`** role. |
| 


### ‚úÖ Acceptance Criteria (AC) and Test Cases

#### **AC 1: Successful Event Creation**

* **Criterion:** A request with a valid `administrator` token and an existing, targeted `userId` must return can POST request for a valid `SpecialEvent` must return an **HTTP 201 Created** response with a single `SpecialEvent` object (including its new `EventID`).
* **Test Case 1.1 (Valid Post):**
    * **PreCondition:**Request includes a valid token for an **`administrator`**
    * **Input Body:** A valid JSON object matching the `SpecialEvent` schema with all required fields.
    * **Expected Output:** **HTTP 201 Created** with a JSON object containing the full event data and a new `EventID`. The `Location` header should ideally point to the newly created resource.
#### **AC 2: Authentication Failure**

* **Criterion:** If the request lacks a valid authentication token, the API must return an **HTTP 401 Unauthorized** response.
* **Test Case 2.1 (Missing Token):**
    * **Input:** A valid JSON object matching the `SpecialEvent` schema with all required fields. without an `Authorization` header.
    * **Expected Output:** **HTTP 401 Unauthorized**.

#### **AC 3: Authorization Failure (Incorrect Role)**

* **Criterion:** If the authenticated user does not possess the required **`administrator`** role, the API must return an **HTTP 403 Forbidden** response.
* **Test Case 3.1 (Non-Admin Role):**
    * **Pre-condition:** Request includes a valid token for a user with the **`standard`** role.
    * **Input:** A valid JSON object matching the `SpecialEvent` schema with all required fields.
    * **Expected Output:** **HTTP 403 Forbidden** with an `ErrorModel` detailing the permission denial.

#### **AC 4: Failure on Bad Request**

* **Criterion:** If the event creation fails due to invalid or missing required data, the API must return an **HTTP 400 Bad Request** response.
* **Test Case 4.1 (Missing Required Field):**
    * **Input Body:** A JSON object where a required field (e.g., `EventName`) is missing or null.
    * **Expected Output:** **HTTP 400 Bad Request** with a structured error model indicating the specific validation failure (e.g., "EventName is required").
* **Test Case 4.2 (Invalid Data Type):**
    * **Input Body:** A JSON object where a field has an incorrect type (e.g., `EventPrice` is a string like `"free"` instead of a number).
    * **Expected Output:** **HTTP 400 Bad Request** with a structured error model indicating the data type mismatch.
* **Test Case 4.3 (Invalid Date Format):**
    * **Input Body:** A JSON object where an entry in `EventDates` is not a valid ISO 8601 date.
    * **Expected Output:** **HTTP 400 Bad Request** with a structured error model indicating the date format error.

***

### üîÑ Response Codes and Models

| Code | Status | Model | Description |
| :--- | :--- | :--- | :--- |
| **201** | Created | `SpecialEvent` (Output) | The special event was successfully created. |
| **400** | Bad Request | `ErrorModel` | The request body contained invalid or incomplete data. |
| **401** | Unauthorized | `ErrorModel` | Missing or invalid **Authentication** (AuthN) credentials. |
| **403** | Forbidden | `ErrorModel` | Insufficient **Authorization** (AuthZ) permissions (e.g., wrong role). |
| **404** | Not Found | `ErrorModel` | (Placeholder) The resource path is correct, but an underlying required resource could not be found (less likely for a POST). |
* *Note: **ErrorModel** should contain fields like `code`, `message`, and `details` to aid client debugging.*

### Implementation for FR-002
- [FR-002] Implement [Service] in museumeapi/services/SpecialEventService.cs.  namespace: MuseumApi.Core. Inject the databasee context into the constructor. it has one method named UpdateSpecialEvent, parameter: SpecialEvent, return SpecialEvent class.  The method will handle pulls or pushes the the database.  It will use entityframework's UpsertFunctionality to update the database tables.  Create an interface called SpecialEventService for this class.  it can be passed to the SpecialEventEndpoint method.  The Interface to Class association should be registred as a Scoped instance in Program.cs.
- [FR-002] Implement [endpoint/feature] in museumapi/endpoint/SpecialEventEndpoint.cs  It will implement the description above the the inputs/outs.  It will pass the SpecialEvent class to the SpeialEventService's method called UpdateSpecialEvent.  endpoints should be versioned V1 in the url
- [FR-002]  Add validation and error handling to the Endpoint layer.  Price must be a postive decimal value.
- [FR-002] Add logging for FR-002 operations


### **Logging"**
-- Add logging on successful (informational level) with input parameters.
-- Add logging on error with inputput parameters and structured exceptions.

### **Authorization**
-- you must have the role of Administrator to create a new SpecialEvent

### **Tests for FR-002**
- [ ] [FR-002] Integration test for in MuseumApi.Test/integration/test_SpecialEvent.cs using xunit.  Try and obtain full coverage.
